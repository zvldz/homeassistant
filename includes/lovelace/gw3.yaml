title: Gateway 3
icon: mdi:signal
panel: true
cards:
  - type: vertical-stack
    cards:
      - type: horizontal-stack
        cards:
          - type: custom:button-card
            name: "Reboot GW3 1"
            icon: "mdi:rotate-3d-variant"
            tap_action:
              confirmation: true
              action: call-service
              service: script.turn_on
              service_data:
                entity_id: script.reboot_gateway_1
            size: 15%
            styles:
              card:
                - font-size: 14px

          - type: custom:button-card
            name: "Reboot GW3 2"
            icon: "mdi:rotate-3d-variant"
            tap_action:
              confirmation: true
              action: call-service
              service: script.turn_on
              service_data:
                entity_id: script.reboot_gateway_2
            size: 15%
            styles:
              card:
                - font-size: 14px

          - type: custom:button-card
            name: "Dump GW3 1"
            icon: "mdi:backup-restore"
            tap_action:
              confirmation: true
              action: call-service
              service: script.turn_on
              service_data:
                entity_id: script.dump_gateway_1
            size: 15%
            styles:
              card:
                - font-size: 14px

          - type: custom:button-card
            name: "Dump GW3 2"
            icon: "mdi:backup-restore"
            tap_action:
              confirmation: true
              action: call-service
              service: script.turn_on
              service_data:
                entity_id: script.dump_gateway_2
            size: 15%
            styles:
              card:
                - font-size: 14px

      - type: 'custom:flex-table-card'
        clickable: true
        title: "Gateways:"
        entities:
          include:
            - sensor.*_gateway
        sort_by: friendly_name
        columns:
          - data: friendly_name
            name: Name
            modify: '(x+"").replace(/ Gateway$/,"")'
          - data: network_pan_id
            name: PAN ID
            align: center
            modify: 'x == "" ? "-" : x+""'
          - data: radio_tx_power
            name: TX Power
            align: center
            modify: 'isNaN(parseInt(x, 10)) ? "-" : parseInt(x, 10)'
          - data: radio_channel
            name: Channel
            align: center
            modify: 'isNaN(parseInt(x, 10)) ? "-" : parseInt(x, 10)'
          - data: free_mem
            name: Mem Free (KB)
            align: center
            modify: 'isNaN(parseInt(x, 10)) ? "" : parseInt(x, 10)'
          - data: load_avg
            name: Load Avg
            align: center
            modify: '(x+"").split("|").slice(0, 3).join(", ")'
          - data: zigbee_tx
            name: Z_TX
            align: center
            modify: x
          - data: zigbee_rx
            name: Z_RX
            align: center
            modify: x
          - data: zigbee_oe
            name: Z_ERR
            align: center
            modify: 'isNaN(parseInt(x, 10)) ? "0" : parseInt(x, 10)'
          - data: bluetooth_tx
            name: B_TX
            align: center
            modify: x
          - data: bluetooth_rx
            name: B_RX
            align: center
            modify: x
          - data: bluetooth_oe
            name: B_ERR
            align: center
            modify: 'isNaN(parseInt(x, 10)) ? "0" : parseInt(x, 10)'
          - data: rssi
            name: RSSI
            align: center
            modify: 'isNaN(parseInt(x, 10)) ? "" : (100 + parseInt(x, 10)) * -1'
          - data: uptime
            name: Uptime
            align: center
            modify: x+''
          - data: state
            name: Connected Since
            align: center
            modify: >
              var dt = new Date(x);
              var hrs = parseInt((Date.now()-Date.parse(x)) / 3600000);
              var min = parseInt(((Date.now()-Date.parse(x)) / 60000) % 60);
              var sec = parseInt(((Date.now()-Date.parse(x)) / 1000) % 60);
              hrs = (hrs < 10) ? "0" + hrs : hrs;
              min = (min < 10) ? "0" + min : min;
              sec = (sec < 10) ? "0" + sec : sec;
              isFinite(dt) ? dt.toLocaleString(['ru-RU', 'en-US']) +
              " (Up: " + hrs + ":" + min + ":" + sec + ")" : ""
        css:
          table+: 'padding-top: 15px;'
          'tbody tr:nth-child(even)': 'background-color: #333333;'
          td.left: 'padding: 10px 10px 10px 10px'
          th.left: 'padding: 10px 10px 10px 10px'
          thead th: 'background-color: #1a1a1a'

      - type: 'custom:flex-table-card'
        title: "ZigBee:"
        clickable: true
        entities:
          include:
            - sensor.*_zigbee
        sort_by: ieee
        columns:
          - data: friendly_name
            name: Name
            modify: 'x.replace(/ Zigbee$/,"")'
          - data: gate
            name: Gateway
            align: center
            modify: x+''
          - data: ieee
            name: IEEE
            align: center
            modify: (x+'').toLowerCase()
          - data: fw_version
            name: FW
            align: center
            modify: x
          - data: nwk
            name: NWK
            align: center
            modify: (x+'').replace(/^0x/,"").toLowerCase()
          - data: parent
            name: Parent
            align: center
            modify: (x+'').replace(/^0x/,"").toLowerCase()
          - data: type
            name: Type
            align: center
            modify: (x+'').replace(/^-$/, "child device")
          - data: msg_received
            name: Received
            align: center
            modify: 'isNaN(parseInt(x, 10)) ? 0 : parseInt(x, 10)'
          - data: msg_missed
            name: Missed
            align: center
            modify: 'isNaN(parseInt(x, 10)) ? 0 : parseInt(x, 10)'
          - data: unresponsive
            name: Unresponsive
            align: center
            modify: 'isNaN(parseInt(x, 10)) ? 0 : parseInt(x, 10)'
          - data: reset_cnt
            name: Resets
            align: center
            modify: 'isNaN(parseInt(x, 10)) ? 0 : parseInt(x, 10)'
          - data: link_quality
            name: LQI
            align: center
            modify: 'isNaN(parseInt(x, 10)) ? "" : parseInt(x, 10)'
          - data: rssi
            name: RSSI
            align: center
            modify: 'isNaN(parseInt(x, 10)) ? "" : parseInt(x, 10)'
          - data: last_msg
            name: Last Msg
            align: center
            modify: x+''
          - data: state
            name: Last Seen
            align: center
            modify: >
              var dt = new Date(0,0,0,0,0,0,(Date.now()-Date.parse(x)));
              isFinite(dt) ? dt.toTimeString().split(" ")[0] : ""
        css:
          table+: 'padding-top: 15px;'
          'tbody tr:nth-child(even)': 'background-color: #333333;'
          td.left: 'padding: 10px 10px 10px 10px'
          th.left: 'padding: 10px 10px 10px 10px'
          thead th: 'background-color: #1a1a1a'

      - type: 'custom:flex-table-card'
        title: "Bluetooth:"
        clickable: true
        entities:
          include:
            - sensor.*_ble
        sort_by: mac
        columns:
          - data: friendly_name
            name: Friendly Name
            modify: 'x.replace(/ Ble$/,"")'
          - data: mac
            name: MAC
            align: center
            modify: (x+'').replace(/(.{2}(?!$))/g,"$1:")
          - data: msg_received
            name: Received
            align: center
            modify: 'isNaN(parseInt(x, 10)) ? "-" : parseInt(x, 10)'
          - data: state
            name: Last Seen
            align: center
            modify: >
              var dt = new Date(0,0,0,0,0,0,(Date.now()-Date.parse(x)));
              isFinite(dt) ? dt.toTimeString().split(" ")[0] : "-"
        css:
          table+: 'padding-top: 15px;'
          'tbody tr:nth-child(even)': 'background-color: #333333;'
          td.left: 'padding: 10px 10px 10px 10px'
          th.left: 'padding: 10px 10px 10px 10px'
          thead th: 'background-color: #1a1a1a'

